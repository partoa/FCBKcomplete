jQuery(function(a){a.fn.fcbkcomplete=function(c){var b=(c.used_vals!=undefined&&a.isArray(c.used_vals))?c.used_vals:[];return this.each(function(){function H(){g();q();u();p(0);N();s.data("setSelected",function(P,O){var Q=a.inArray(P,l);if(O&&Q<0){l.push(P)}else{if(!O&&Q>-1){l.splice(Q,1)}}})}function u(){setTimeout(function(){var O=t.prev();var P=O.position();t.css({top:(P.top+O.outerHeight(true)),position:"absolute","z-index":z.zIndex,left:P.left})},0)}function r(P,O){if(z.connect_with){a(z.connect_with).each(function(){if(this!=s[0]){var Q=a(this).data("setSelected");if(typeof Q=="function"){Q(P,O)}}})}}function g(){if(s.context.tagName.toUpperCase()!="SELECT"){var O=s[0].id;var P=a(document.createElement("select"));if(z.php_mode){P.attr("name",s[0].name+"[]")}else{P.attr("name",s[0].name)}s.replaceWith(P);s=P;s.attr("id",O)}s.hide();if(z.maxitems>1){s.attr("multiple","multiple")}I=a(document.createElement("ul"));I.attr("class",z.class_names.holder);s.after(I);t=a(document.createElement("div"));t.addClass(z.class_names.complete);if(z.complete_text){t.append('<div class="default">'+z.complete_text+"</div>")}if(A){t.append('<iframe class="ie6fix" scrolling="no" frameborder="0"></iframe>');M=t.children(".ie6fix")}h=a(document.createElement("ul"));h.attr("id",f+"_feed");t.prepend(h);I.after(t);if(z.force_width){h.css("width",z.width)}else{if(z.auto_width){h.css("width",t.width())}}}function N(R){var P=a(z.layer_selector);if(P!=null&&P.length>0){var O=0;var Q=a(R);a(z.layer_selector).each(function(){var S=parseInt(a(this).css("z-index"));if(Q[0]!=this&&S>O){O=S}});Q.css({"z-index":(O+1)})}}function q(){if(z.data&&a.isArray(z.data)){a.each(z.data,function(O,P){o.push({caption:P.name,value:P.id});b.push(P.id)})}else{s.children("option").each(function(O,P){P=a(P);if(z.maxitems>1){if(P.hasClass("selected")||P.is(":selected")){J(P.text(),P.val(),true,P.hasClass("locked"));P.attr("selected","selected");b.push(P.val())}}else{P.removeAttr("selected")}o.push({caption:P.text(),value:P.val()});F+=""+(o.length-1)+":"+P.text()+";"})}}a(this).bind("addItem",function(P,Q){if(a.isArray(Q)){for(var O=0;O<Q.length;O++){J(Q[O].title,Q[O].value,0,0,0)}}else{J(Q.title,Q.value,0,0,0)}});function J(U,V,R,P,X){if(!G()){return false}var W=document.createElement("li");var Q=document.createTextNode(U);var T=document.createElement("a");var O="bit-box"+(P?" locked":"");a(W).attr({"class":O,rel:V});a(W).prepend(Q);a(T).attr({"class":z.class_names.closebutton,href:"#"});W.appendChild(T);I.append(W);a(T).click(function(){k(a(this).parent("li"));return false});if(!R){m.remove();var S;p(X);if(s.children("option[value="+V+"]").length){S=s.children("option[value="+V+"]");S.get(0).setAttribute("selected","selected");if(!S.hasClass("selected")){S.addClass("selected")}}else{var S=a(document.createElement("option"));S.attr("value",V).get(0).setAttribute("selected","selected");S.attr("value",V).addClass("selected");S.text(U);s.append(S)}if(z.connect_with=="Array"&&a.inArray(V,b)<0){b.push(V.toString())}else{if(z.connect_with&&z.connect_with!="Array"){r(V.toString(),true)}}if(typeof z.onselect=="function"){w(z.onselect,S)}s.change()}I.children("li.bit-box.deleted").removeClass("deleted");h.hide();A?M.hide():""}function k(P){if(!P.hasClass("locked")){P.fadeOut("fast");var Q=P.attr("rel");if(z.connect_with=="Array"){var R=a.inArray(Q,b);if(R>-1){b.splice(R,1)}}else{if(z.connect_with&&z.connect_with!="Array"){r(Q,false)}}if(typeof z.onremove=="function"){var O=s.children("option[value="+Q+"]");w(z.onremove,O)}s.children('option[value="'+P.attr("rel")+'"]').removeAttr("selected").removeClass("selected");P.remove();s.change();C=0}}function p(P){m=a('<li class="bit-input" id="'+f+'_annoninput"><input type="text" class="maininput" size="1" autocomplete="off" /></li>');var O=m;d=O.children(":first");var Q=0;I.append(O);d.focus(function(){t.fadeIn("fast")});d.blur(function(){t.fadeOut("fast")});I.click(function(){u();d.focus();if(h.length&&(d.val().length||z.default_search.length)){if(z.default_search.length&&!d.val().length){d.keyup()}h.show()}else{h.hide();A?M.hide():"";t.children(".default").show()}});d.keypress(function(R){if(R.keyCode==13||R.keyCode==9){return true}d.attr("size",d.val().length+1)});d.keydown(function(R){if(R.keyCode==191){R.preventDefault();return false}});d.keyup(function(S){var R=d.val();var V=L(R==""?z.default_search:R);if(S.keyCode==8&&V==z.default_search){h.hide();A?M.hide():"";if(!I.children("li.bit-box:last").hasClass("locked")){if(I.children("li.bit-box.deleted").length==0){I.children("li.bit-box:last").addClass("deleted");return false}else{if(C){return}C=1;I.children("li.bit-box.deleted").fadeOut("fast",function(){k(a(this));return false})}}}if(S.keyCode!=40&&S.keyCode!=38&&V.length!=0){e=0;if(z.json_url){if(z.cache&&n){i(V);K()}else{Q++;var U=Q;setTimeout(function(){if(U!=Q){return}a.getJSON(z.json_url+(z.json_url.indexOf("?")>-1?"&":"?")+"tag="+V,null,function(W){i(V,W);n=true;K()})},z.delay)}}else{var T=undefined;if(z.preset_update){T=new Array();s.children("option").each(function(W,X){X=a(X);if(X.is(":selected")||X.is(".selected")){return undefined}T.push({caption:X.text(),value:X.val()})})}i(V,T);K()}u();t.children(".default").hide();h.show()}});if(P){setTimeout(function(){d.focus();u();t.children(".default").show()},1)}}function i(P,T){h.html("");P=P==""?z.default_search:P;if(!z.cache&&T!=null){o=new Array();F=""}if(z.default_search!=P){j(P)}if(T!=null&&T.length){a.each(T,function(aa,ab){o.push({caption:ab.caption,value:ab.value});F+=""+(o.length-1)+":"+ab.caption+";"})}var S=z.maxshownitems<o.length?z.maxshownitems:o.length;var Q="i";if(z.filter_case){Q=""}var Z,V;try{Z=new RegExp("(?:^|;)\\s*(\\d+)\\s*:[^;]*?"+P+"[^;]*","g"+Q);V=Z.exec(F)}catch(Y){}var W="";while(V!=null&&S>0){var O=V[1];var R=o[O];var U=a.inArray(R.value.toString(),l);if(U<0&&z.connect_with=="Array"){U=a.inArray(R.value.toString(),b)}if(U<0){var X=s.children("option[value="+R.value+"]");if(X.length==0){X=s.children(":contains('"+R.value+"')")}U=(X.length>0&&z.filter_selected&&(X.is(".selected")||X.is(":selected")))}else{U=true}if(!U){W+='<li rel="'+R.value+'">'+E(R.caption,P)+"</li>";e++;S--}V=Z.exec(F)}h.append(W);if(z.firstselected){D=h.children("li:first");D.addClass("auto-focus")}if(e>z.height){h.css({height:(z.height*24)+"px",overflow:"auto"});if(A){if(z.auto_width){M.css({width:h.width()+"px"})}M.css({height:(z.height*24)+"px"}).show()}}else{h.css("height","auto");if(A){if(z.auto_width){M.css({width:h.width()+"px"})}M.css({height:h.height()+"px"}).show()}}}function E(P,Q){if(z.filter_case){try{var P=P.replace(new RegExp('(.*)("'+Q+'")(.*)',"gi"),"$1<em>$2</em>$3")}catch(O){}}else{try{var P=P.replace(new RegExp('(.*)("'+Q.toLowerCase()+'")(.*)',"gi"),"$1<em>$2</em>$3")}catch(O){}}return P}function v(){h.children("li").mouseover(function(){h.children("li").removeClass("auto-focus");a(this).addClass("auto-focus");D=a(this)});h.children("li").mouseout(function(){a(this).removeClass("auto-focus");D=null})}function y(){h.children("li").unbind("mouseover");h.children("li").unbind("mouseout");h.mousemove(function(){v();h.unbind("mousemove")})}function K(){var O=m.children(".maininput");v();h.children("li").unbind("mousedown");h.children("li").mousedown(function(){var P=a(this);J(P.text(),P.attr("rel"));h.hide();A?M.hide():"";t.hide()});O.unbind("keydown");O.keydown(function(S){if(S.keyCode==191){S.preventDefault();return false}if(S.keyCode!=8){I.children("li.bit-box.deleted").removeClass("deleted")}if((S.keyCode==13&&z.choose_on_enter)||(S.keyCode==9&&z.choose_on_tab)||(S.keyCode==188&&z.choose_on_comma)){if(x()){var Q=D;J(Q.text(),Q.attr("rel"));t.hide();S.preventDefault();D=null;if(z.keep_prompt_after_choose){I.trigger("click")}return false}else{if(z.newel){var T=L(a(this).val());if(T){J(T,T);S.preventDefault();d.focus()}else{t.hide()}D=null}if(z.keep_prompt_after_choose){I.trigger("click")}return false}}if(S.keyCode==40){y();if(D==null||D.length==0){D=h.children("li:first");h.get(0).scrollTop=0}else{D.removeClass("auto-focus");D=D.next();var R=parseInt(D.prevAll("li").length);var P=parseInt(D.nextAll("li").length);if((R>Math.round(z.height/2)||P<=Math.round(z.height/2))&&typeof(D.get(0))!="undefined"){h.get(0).scrollTop=parseInt(D.get(0).scrollHeight,10)*(R-Math.round(z.height/2))}}h.children("li").removeClass("auto-focus");D.addClass("auto-focus")}if(S.keyCode==38){y();if(D==null||D.length==0){D=h.children("li:last");h.get(0).scrollTop=parseInt(D.get(0).scrollHeight)*(parseInt(h.children("li").length)-Math.round(z.height/2))}else{D.removeClass("auto-focus");D=D.prev();var R=parseInt(D.prevAll("li").length);var P=parseInt(D.nextAll("li").length);if((P>Math.round(z.height/2)||R<=Math.round(z.height/2))&&typeof(D.get(0))!="undefined"){h.get(0).scrollTop=parseInt(D.get(0).scrollHeight)*(R-Math.round(z.height/2))}}h.children("li").removeClass("auto-focus");D.addClass("auto-focus")}})}function G(){if(z.maxitems!=0){if(I.children("li.bit-box").length<z.maxitems){return true}else{return false}}}function j(P){if(z.newel&&G()){h.children("li[fckb=1]").remove();if(P.length==0){return}var O=a(document.createElement("li"));O.attr({rel:P,fckb:"1"}).html(P);h.prepend(O);e++}else{return}}function w(Q,P){var R={};for(var O=0;O<P.get(0).attributes.length;O++){if(P.get(0).attributes[O].nodeValue!=null){R["_"+P.get(0).attributes[O].nodeName]=P.get(0).attributes[O].nodeValue}}Q.call(s[0],R)}function x(){if(D==null){return false}if(D.length==0){return false}return true}function L(O){O=O.replace(/[\"\'][\s]*javascript:(.*)[\"\']/g,'""');O=O.replace(/script(.*)/g,"");O=O.replace(/eval\((.*)\)/g,"");O=O.replace("/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/","");return O}var B={holder:"holder",complete:"facebook-auto",closebutton:"closebutton"};var z=a.extend({json_url:null,cache:false,height:"10",newel:false,firstselected:false,filter_case:false,filter_hide:false,complete_text:"Start to type...",default_search:".*?",maxshownitems:30,preset_update:true,maxitems:10,data:false,connect_with:false,onselect:"",onremove:"",delay:10,zIndex:1,used_vals:new Array(),force_width:null,auto_width:true,choose_on_comma:true,choose_on_tab:true,choose_on_enter:true,keep_prompt_after_choose:true,layer_selector:"",php_mode:true,class_names:B},c);if(z.class_names!==B){z.class_names=a.extend({},B,z.class_names)}var I=null;var h=null;var t=null;var e=0;var o=new Array();var n=false;var F="";var D=null;var C=0;var A="\v"=="v";var M;var s=a(this);var f=s.attr("id");var m=null;var d=null;var l=new Array();f=(f!=""&&f!=null)?f:"fcbkselect_"+Math.floor(Math.random()*100000);H();return this})}});