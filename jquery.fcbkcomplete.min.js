jQuery(function(a){a.fn.fcbkcomplete=function(c){var b=(c.used_vals!=undefined&&a.isArray(c.used_vals))?c.used_vals:[];return this.each(function(){function G(){g();q();u();p(0);M();s.data("setSelected",function(O,N){var P=a.inArray(O,l);if(N&&P<0){l.push(O)}else{if(!N&&P>-1){l.splice(P,1)}}})}function u(){setTimeout(function(){var N=t.prev();var O=N.position();t.css({top:(O.top+N.outerHeight(true)),position:"absolute","z-index":z.zIndex,left:O.left})},0)}function r(O,N){if(z.connect_with){a(z.connect_with).each(function(){if(this!=s[0]){var P=a(this).data("setSelected");if(typeof P=="function"){P(O,N)}}})}}function g(){s.hide();s.attr("multiple","multiple");if(s.attr("name").indexOf("[]")==-1){s.attr("name",s.attr("name")+"[]")}H=a(document.createElement("ul"));H.attr("class","holder");s.after(H);t=a(document.createElement("div"));t.addClass("facebook-auto");t.append('<div class="default">'+z.complete_text+"</div>");if(A){t.append('<iframe class="ie6fix" scrolling="no" frameborder="0"></iframe>');L=t.children(".ie6fix")}h=a(document.createElement("ul"));h.attr("id",f+"_feed");t.prepend(h);H.after(t);if(z.force_width){h.css("width",z.width)}else{if(z.auto_width){h.css("width",t.width())}}}function M(Q){var O=a(z.layer_selector);if(O!=null&&O.length>0){var N=0;var P=a(Q);a(z.layer_selector).each(function(){var R=parseInt(a(this).css("z-index"));if(P[0]!=this&&R>N){N=R}});P.css({"z-index":(N+1)})}}function q(){if(z.data&&a.isArray(z.data)){a.each(z.data,function(N,O){o.push({caption:O.name,value:O.id});b.push(O.id)})}else{s.children("option").each(function(N,O){O=a(O);if(O.hasClass("selected")||O.is(":selected")){I(O.text(),O.val(),true,O.hasClass("locked"));O.attr("selected","selected");b.push(O.val())}else{O.removeAttr("selected")}o.push({caption:O.text(),value:O.val()});E+=""+(o.length-1)+":"+O.text()+";"})}}a(this).bind("addItem",function(N,O){I(O.title,O.value,0,0,0)});function I(T,U,Q,O,W){if(!F()){return false}var V=document.createElement("li");var P=document.createTextNode(T);var S=document.createElement("a");var N="bit-box"+(O?" locked":"");a(V).attr({"class":N,rel:U});a(V).prepend(P);a(S).attr({"class":"closebutton",href:"#"});V.appendChild(S);H.append(V);a(S).click(function(){k(a(this).parent("li"));return false});if(!Q){m.remove();var R;p(W);if(s.children("option[value="+U+"]").length){R=s.children("option[value="+U+"]");R.get(0).setAttribute("selected","selected");if(!R.hasClass("selected")){R.addClass("selected")}}else{var R=a(document.createElement("option"));R.attr("value",U).get(0).setAttribute("selected","selected");R.attr("value",U).addClass("selected");R.text(T);s.append(R)}if(z.connect_with=="Array"&&a.inArray(U,b)<0){b.push(U.toString())}else{if(z.connect_with&&z.connect_with!="Array"){r(U.toString(),true)}}if(typeof z.onselect=="function"){w(z.onselect,R)}s.change()}H.children("li.bit-box.deleted").removeClass("deleted");h.hide();A?L.hide():""}function k(O){if(!O.hasClass("locked")){O.fadeOut("fast");var P=O.attr("rel");if(z.connect_with=="Array"){var Q=a.inArray(P,b);if(Q>-1){b.splice(Q,1)}}else{if(z.connect_with&&z.connect_with!="Array"){r(P,false)}}if(typeof z.onremove=="function"){var N=s.children("option[value="+P+"]");w(z.onremove,N)}s.children('option[value="'+O.attr("rel")+'"]').removeAttr("selected").removeClass("selected");O.remove();s.change();B=0}}function p(O){m=a('<li class="bit-input" id="'+f+'_annoninput"><input type="text" class="maininput" size=1 /></li>');var N=m;d=N.children(":first");var P=0;H.append(N);d.focus(function(){t.fadeIn("fast")});d.blur(function(){t.fadeOut("fast")});H.click(function(){u();if(h.length&&(d.val().length||z.default_search.length)){if(z.default_search.length&&!d.val().length){d.focus();d.keyup()}h.show()}else{h.hide();A?L.hide():"";t.children(".default").show()}});d.keypress(function(Q){if(Q.keyCode==13||Q.keyCode==9){return false}d.attr("size",d.val().length+1)});d.keydown(function(Q){if(Q.keyCode==191){Q.preventDefault();return false}});d.keyup(function(R){var Q=d.val();var U=K(Q==""?z.default_search:Q);if(R.keyCode==8&&U.length==0){h.hide();A?L.hide():"";if(!H.children("li.bit-box:last").hasClass("locked")){if(H.children("li.bit-box.deleted").length==0){H.children("li.bit-box:last").addClass("deleted");return false}else{if(B){return}B=1;H.children("li.bit-box.deleted").fadeOut("fast",function(){k(a(this));return false})}}}if(R.keyCode!=40&&R.keyCode!=38&&U.length!=0){e=0;if(z.json_url){if(z.cache&&n){i(U);J()}else{P++;var T=P;setTimeout(function(){if(T!=P){return}a.getJSON(z.json_url+(z.json_url.indexOf("?")>-1?"&":"?")+"tag="+U,null,function(V){i(U,V);n=true;J()})},z.delay)}}else{var S=undefined;if(z.preset_update){S=new Array();s.children("option").each(function(V,W){W=a(W);if(W.is(":selected")||W.is(".selected")){return undefined}S.push({caption:W.text(),value:W.val()})})}i(U,S);J()}u();t.children(".default").hide();h.show()}});if(O){setTimeout(function(){d.focus();u();t.children(".default").show()},1)}}function i(O,S){h.html("");O=O==""?z.default_search:O;if(!z.cache&&S!=null){o=new Array();E=""}if(z.default_search!=O){j(O)}if(S!=null&&S.length){a.each(S,function(Z,aa){o.push({caption:aa.caption,value:aa.value});E+=""+(o.length-1)+":"+aa.caption+";"})}var R=z.maxshownitems<o.length?z.maxshownitems:o.length;var P="i";if(z.filter_case){P=""}var Y,U;try{Y=new RegExp("(?:^|;)\\s*(\\d+)\\s*:[^;]*?"+O+"[^;]*","g"+P);U=Y.exec(E)}catch(X){}var V="";while(U!=null&&R>0){var N=U[1];var Q=o[N];var T=a.inArray(Q.value.toString(),l);if(T<0&&z.connect_with=="Array"){T=a.inArray(Q.value.toString(),b)}if(T<0){var W=s.children("option[value="+Q.value+"]");if(W.length==0){W=s.children(":contains('"+Q.value+"')")}T=(W.length>0&&z.filter_selected&&(W.is(".selected")||W.is(":selected")))}else{T=true}if(!T){V+='<li rel="'+Q.value+'">'+D(Q.caption,O)+"</li>";e++;R--}U=Y.exec(E)}h.append(V);if(z.firstselected){C=h.children("li:first");C.addClass("auto-focus")}if(e>z.height){h.css({height:(z.height*24)+"px",overflow:"auto"});if(A){if(z.auto_width){L.css({width:h.width()+"px"})}L.css({height:(z.height*24)+"px"}).show()}}else{h.css("height","auto");if(A){if(z.auto_width){L.css({width:h.width()+"px"})}L.css({height:h.height()+"px"}).show()}}}function D(O,P){if(z.filter_case){try{var O=O.replace(new RegExp('(.*)("'+P+'")(.*)',"gi"),"$1<em>$2</em>$3")}catch(N){}}else{try{var O=O.replace(new RegExp('(.*)("'+P.toLowerCase()+'")(.*)',"gi"),"$1<em>$2</em>$3")}catch(N){}}return O}function v(){h.children("li").mouseover(function(){h.children("li").removeClass("auto-focus");a(this).addClass("auto-focus");C=a(this)});h.children("li").mouseout(function(){a(this).removeClass("auto-focus");C=null})}function y(){h.children("li").unbind("mouseover");h.children("li").unbind("mouseout");h.mousemove(function(){v();h.unbind("mousemove")})}function J(){var N=m.children(".maininput");v();h.children("li").unbind("mousedown");h.children("li").mousedown(function(){var O=a(this);I(O.text(),O.attr("rel"));h.hide();A?L.hide():"";t.hide()});N.unbind("keydown");N.keydown(function(R){if(R.keyCode==191){R.preventDefault();return false}if(R.keyCode!=8){H.children("li.bit-box.deleted").removeClass("deleted")}if((R.keyCode==13&&z.choose_on_enter)||(R.keyCode==9&&z.choose_on_tab)||(R.keyCode==188&&z.choose_on_comma)){if(x()){var P=C;I(P.text(),P.attr("rel"));t.hide();R.preventDefault();C=null;if(z.keep_prompt_after_choose){H.trigger("click")}return false}else{if(z.newel){var S=K(a(this).val());I(S,S);t.hide();R.preventDefault();C=null}if(z.keep_prompt_after_choose){H.trigger("click")}return false}}if(R.keyCode==40){y();if(C==null||C.length==0){C=h.children("li:first");h.get(0).scrollTop=0}else{C.removeClass("auto-focus");C=C.next();var Q=parseInt(C.prevAll("li").length);var O=parseInt(C.nextAll("li").length);if((Q>Math.round(z.height/2)||O<=Math.round(z.height/2))&&typeof(C.get(0))!="undefined"){h.get(0).scrollTop=parseInt(C.get(0).scrollHeight,10)*(Q-Math.round(z.height/2))}}h.children("li").removeClass("auto-focus");C.addClass("auto-focus")}if(R.keyCode==38){y();if(C==null||C.length==0){C=h.children("li:last");h.get(0).scrollTop=parseInt(C.get(0).scrollHeight)*(parseInt(h.children("li").length)-Math.round(z.height/2))}else{C.removeClass("auto-focus");C=C.prev();var Q=parseInt(C.prevAll("li").length);var O=parseInt(C.nextAll("li").length);if((O>Math.round(z.height/2)||Q<=Math.round(z.height/2))&&typeof(C.get(0))!="undefined"){h.get(0).scrollTop=parseInt(C.get(0).scrollHeight)*(Q-Math.round(z.height/2))}}h.children("li").removeClass("auto-focus");C.addClass("auto-focus")}})}function F(){if(z.maxitems!=0){if(H.children("li.bit-box").length<z.maxitems){return true}else{return false}}}function j(O){if(z.newel&&F()){h.children("li[fckb=1]").remove();if(O.length==0){return}var N=a(document.createElement("li"));N.attr({rel:O,fckb:"1"}).html(O);h.prepend(N);e++}else{return}}function w(P,O){var Q={};for(var N=0;N<O.get(0).attributes.length;N++){if(O.get(0).attributes[N].nodeValue!=null){Q["_"+O.get(0).attributes[N].nodeName]=O.get(0).attributes[N].nodeValue}}P.call(s[0],Q)}function x(){if(C==null){return false}if(C.length==0){return false}return true}function K(N){N=N.replace(/[\"\'][\s]*javascript:(.*)[\"\']/g,'""');N=N.replace(/script(.*)/g,"");N=N.replace(/eval\((.*)\)/g,"");N=N.replace("/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/","");return N}var z=a.extend({json_url:null,cache:false,height:"10",newel:false,firstselected:false,filter_case:false,filter_hide:false,complete_text:"Start to type...",default_search:".*?",maxshownitems:30,preset_update:true,maxitems:10,data:false,connect_with:false,onselect:"",onremove:"",delay:10,zIndex:1,used_vals:new Array(),force_width:null,auto_width:true,choose_on_comma:true,choose_on_tab:true,choose_on_enter:true,keep_prompt_after_choose:true,layer_selector:""},c);var H=null;var h=null;var t=null;var e=0;var o=new Array();var n=false;var E="";var C=null;var B=0;var A="\v"=="v";var L;var s=a(this);var f=s.attr("id");var m=null;var d=null;var l=new Array();f=(f!=""&&f!=null)?f:"fcbkselect_"+Math.floor(Math.random()*100000);G();return this})}});